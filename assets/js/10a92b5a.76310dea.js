"use strict";(self.webpackChunkaps_tutorials_website=self.webpackChunkaps_tutorials_website||[]).push([[5832],{80:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>_,contentTitle:()=>S,default:()=>I,frontMatter:()=>T,metadata:()=>E,toc:()=>x});var r=t(8168),o=(t(6540),t(5680)),a=t(4472);const i={toc:[]},s="wrapper";function l(e){let{components:n,...t}=e;return(0,o.yg)(s,(0,r.A)({},i,t,{components:n,mdxType:"MDXLayout"}),(0,o.yg)("p",null,"Create an ",(0,o.yg)("inlineCode",{parentName:"p"},"aps.js")," file under the ",(0,o.yg)("inlineCode",{parentName:"p"},"services")," folder. This is where we will be implementing\nall the APS logic that will be used in different areas of our server application. Let's start\nby adding the following code to the file:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js",metastring:'title="services/aps.js"',title:'"services/aps.js"'},"const { SdkManagerBuilder } = require('@aps_sdk/autodesk-sdkmanager');\nconst { AuthenticationClient, Scopes, ResponseType } = require('@aps_sdk/authentication');\n\nconst { APS_CLIENT_ID, APS_CLIENT_SECRET, APS_CALLBACK_URL } = require('../config.js');\n\nconst service = module.exports = {};\n\nconst sdk = SdkManagerBuilder.create().build();\nconst authenticationClient = new AuthenticationClient(sdk);\n\nservice.getAuthorizationUrl = () => authenticationClient.authorize(APS_CLIENT_ID, ResponseType.Code, APS_CALLBACK_URL, [\n    Scopes.DataRead,\n    Scopes.AccountRead,\n    Scopes.AccountWrite\n]);\n\nservice.authCallbackMiddleware = async (req, res, next) => {\n    const credentials = await authenticationClient.getThreeLeggedToken(APS_CLIENT_ID, req.query.code, APS_CALLBACK_URL,{clientSecret:APS_CLIENT_SECRET});\n    req.session.token = credentials.access_token;\n    req.session.refresh_token = credentials.refresh_token;\n    req.session.expires_at = Date.now() + credentials.expires_in * 1000;\n    next();\n};\n\nservice.authRefreshMiddleware = async (req, res, next) => {\n    const { refresh_token, expires_at } = req.session;\n    if (!refresh_token) {\n        res.status(401).end();\n        return;\n    }\n\n    if (expires_at < Date.now()) {\n        const credentials = await authenticationClient.getRefreshToken(APS_CLIENT_ID, refresh_token, {\n            clientSecret: APS_CLIENT_SECRET,\n            scopes: [\n                Scopes.DataRead,\n                Scopes.AccountRead,\n                Scopes.AccountWrite\n            ]\n        });\n        req.session.token = credentials.access_token;\n        req.session.refresh_token = credentials.refresh_token;\n        req.session.expires_at = Date.now() + credentials.expires_in * 1000;\n    }\n    req.oAuthToken = {\n        access_token: req.session.token,\n        expires_in: Math.round((req.session.expires_at - Date.now()) / 1000)\n    };\n    next();\n};\n\nservice.getUserProfile = async (token) => {\n    const resp = await authenticationClient.getUserInfo(token.access_token);\n    return resp;\n};\n")),(0,o.yg)("p",null,"The code provides a couple of helper functions:"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"the ",(0,o.yg)("inlineCode",{parentName:"li"},"getAuthorizationUrl")," function generates a URL for our users to be redirected to when\ninitiating the 3-legged authentication workflow"),(0,o.yg)("li",{parentName:"ul"},"the ",(0,o.yg)("inlineCode",{parentName:"li"},"authCallbackMiddleware")," function can be used as an Express.js middleware\nwhen the user logs in successfully and is redirected back to our application"),(0,o.yg)("li",{parentName:"ul"},"the ",(0,o.yg)("inlineCode",{parentName:"li"},"authRefreshMiddleware")," function is then used as an Express.js middleware for all requests\nthat will need to make use of the APS access tokens"),(0,o.yg)("li",{parentName:"ul"},"the ",(0,o.yg)("inlineCode",{parentName:"li"},"getUserProfile")," function returns additional details about the authenticated user based on\nan existing access token")))}l.isMDXComponent=!0;const c={toc:[]},u="wrapper";function p(e){let{components:n,...t}=e;return(0,o.yg)(u,(0,r.A)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,o.yg)("p",null,"Create an ",(0,o.yg)("inlineCode",{parentName:"p"},"auth.js")," file under the ",(0,o.yg)("inlineCode",{parentName:"p"},"routes")," subfolder with the following content:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js",metastring:'title="routes/auth.js"',title:'"routes/auth.js"'},"const express = require('express');\nconst { getAuthorizationUrl, authCallbackMiddleware, authRefreshMiddleware, getUserProfile } = require('../services/aps.js');\n\nlet router = express.Router();\n\nrouter.get('/api/auth/login', function (req, res) {\n    res.redirect(getAuthorizationUrl());\n});\n\nrouter.get('/api/auth/logout', function (req, res) {\n    req.session = null;\n    res.redirect('/');\n});\n\nrouter.get('/api/auth/callback', authCallbackMiddleware, function (req, res) {\n    res.redirect('/');\n});\n\nrouter.get('/api/auth/profile', authRefreshMiddleware, async function (req, res, next) {\n    try {\n        const profile = await getUserProfile(req.oAuthToken);\n        res.json({ name: `${profile.name}` });\n    } catch (err) {\n        next(err);\n    }\n});\n\nmodule.exports = router;\n")),(0,o.yg)("p",null,"Here we implement a new Express.js ",(0,o.yg)("a",{parentName:"p",href:"http://expressjs.com/en/4x/api.html#router"},"router"),' that\nwill handle all the authentication-related endpoints. Let\'s "mount" the router to our server\napplication by modifying ',(0,o.yg)("inlineCode",{parentName:"p"},"server.js"),":"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js",metastring:'title="server.js"',title:'"server.js"'},"const express = require('express');\nconst session = require('cookie-session');\nconst { PORT, SERVER_SESSION_SECRET } = require('./config.js');\n\nlet app = express();\napp.use(express.static('wwwroot'));\napp.use(session({ secret: SERVER_SESSION_SECRET, maxAge: 24 * 60 * 60 * 1000 }));\n// highlight-start\napp.use(require('./routes/auth.js'));\n// highlight-end\napp.listen(PORT, () => console.log(`Server listening on port ${PORT}...`));\n")),(0,o.yg)("p",null,"The router will now handle the following requests:"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"GET /api/auth/login")," will redirect the user to the Autodesk login page"),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"GET /api/auth/callback")," is the URL our user will be redirected to after logging in successfully,\nand it is where we're going to generate a new set of tokens for the user"),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"GET /api/auth/logout")," will remove any cookie-based session data for the given user, effectively\nlogging the user out of our application"),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"GET /api/auth/profile")," will return a simple JSON with additional information about the logged in user")))}p.isMDXComponent=!0;var d=t(7408);const g={toc:[]},h="wrapper";function m(e){let{components:n,...t}=e;return(0,o.yg)(h,(0,r.A)({},g,t,{components:n,mdxType:"MDXLayout"}),(0,o.yg)("p",null,"Create an ",(0,o.yg)("inlineCode",{parentName:"p"},"APS.cs")," file under the ",(0,o.yg)("inlineCode",{parentName:"p"},"Models")," subfolder. This is where we will be implementing\nthe APS-specific logic that will be used in different areas of our server application. Let's\nstart by adding the following code to the file:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-csharp",metastring:'title="Models/APS.cs"',title:'"Models/APS.cs"'},"using System;\nusing System.Collections.Generic;\nusing Autodesk.SDKManager;\nusing Autodesk.Authentication.Model;\n\npublic class Tokens\n{\n    public string? AccessToken;\n    public string? RefreshToken;\n    public DateTime ExpiresAt;\n}\n\npublic partial class APS\n{\n    private readonly string _clientId;\n    private readonly string _clientSecret;\n    private readonly string _callbackUri;\n    private SDKManager _SDKManager;\n    private readonly List<Scopes> TokenScopes = new List<Scopes> { Scopes.DataRead, Scopes.AccountRead, Scopes.AccountWrite };\n\n    public APS(string clientId, string clientSecret, string callbackUri)\n    {\n        _clientId = clientId;\n        _clientSecret = clientSecret;\n        _callbackUri = callbackUri;\n        _SDKManager = SdkManagerBuilder.Create().Build();\n    }\n}\n")),(0,o.yg)("p",null,"Notice that the ",(0,o.yg)("inlineCode",{parentName:"p"},"APS")," class is declared as ",(0,o.yg)("inlineCode",{parentName:"p"},"partial"),". We're going to extend it\nin other ",(0,o.yg)("inlineCode",{parentName:"p"},"*.cs")," files later. An ",(0,o.yg)("inlineCode",{parentName:"p"},"APS")," singleton will then be provided to our server\nthrough ASP.NET's ",(0,o.yg)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/aspnet/core/fundamentals/dependency-injection?view=aspnetcore-6.0"},"dependency injection"),"."),(0,o.yg)("p",null,"Next, let's create an ",(0,o.yg)("inlineCode",{parentName:"p"},"APS.Auth.cs")," file under the ",(0,o.yg)("inlineCode",{parentName:"p"},"Models")," subfolder with the following code:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-csharp",metastring:'title="Models/APS.Auth.cs"',title:'"Models/APS.Auth.cs"'},"using System;\nusing System.Threading.Tasks;\nusing Autodesk.Authentication;\nusing Autodesk.Authentication.Model;\n\npublic partial class APS\n{\n    public string GetAuthorizationURL()\n    {\n        AuthenticationClient authenticationClient = new AuthenticationClient(_SDKManager);\n        return authenticationClient.Authorize(_clientId, ResponseType.Code, _callbackUri, TokenScopes);\n\n    }\n\n    public async Task<Tokens> GenerateTokens(string code)\n    {\n        AuthenticationClient authenticationClient = new AuthenticationClient(_SDKManager);\n        dynamic Token = await authenticationClient.GetThreeLeggedTokenAsync(_clientId,code,_callbackUri, _clientSecret);\n        \n        return new Tokens\n        {\n            AccessToken = Token.AccessToken,\n            RefreshToken = Token.RefreshToken,\n            ExpiresAt = DateTime.Now.ToUniversalTime().AddSeconds(Token.ExpiresIn)\n        };\n    }\n\n    public async Task<Tokens> RefreshTokens(Tokens tokens)\n    {\n        AuthenticationClient authenticationClient = new AuthenticationClient(_SDKManager);\n        dynamic Token = await authenticationClient.RefreshTokenAsync(tokens.RefreshToken, _clientId, _clientSecret,TokenScopes);\n        return new Tokens\n        {\n            AccessToken = Token.AccessToken,\n            RefreshToken = Token.RefreshToken,\n            ExpiresAt = DateTime.Now.ToUniversalTime().AddSeconds(Token.ExpiresIn)\n        };\n    }\n\n    public async Task<dynamic> GetUserProfile(Tokens tokens)\n    {\n        AuthenticationClient authenticationClient = new AuthenticationClient(_SDKManager);\n        dynamic profile = await authenticationClient.GetUserInfoAsync(tokens.AccessToken);\n        return profile;\n    }\n}\n")),(0,o.yg)("p",null,"These helper methods will later be used in our server's controllers to handle\nvarious types of requests related to authentication, for example, redirecting the user\nto the Autodesk login page, processing the callback when the user gets redirected back\nto our application, or refreshing tokens that have expired."),(0,o.yg)("p",null,"Finally, let's update our ",(0,o.yg)("inlineCode",{parentName:"p"},"Startup.cs")," file to make a singleton instance of the ",(0,o.yg)("inlineCode",{parentName:"p"},"APS")," class\navailable to our server application:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-csharp",metastring:'title="Startup.cs"',title:'"Startup.cs"'},'using System;\nusing Microsoft.AspNetCore.Builder;\nusing Microsoft.AspNetCore.Hosting;\nusing Microsoft.Extensions.Configuration;\nusing Microsoft.Extensions.DependencyInjection;\nusing Microsoft.Extensions.Hosting;\n\npublic class Startup\n{\n    public Startup(IConfiguration configuration)\n    {\n        Configuration = configuration;\n    }\n\n    public IConfiguration Configuration { get; }\n\n    // This method gets called by the runtime. Use this method to add services to the container.\n    public void ConfigureServices(IServiceCollection services)\n    {\n        services.AddControllers().AddNewtonsoftJson();\n        var clientID = Configuration["APS_CLIENT_ID"];\n        var clientSecret = Configuration["APS_CLIENT_SECRET"];\n        var callbackURL = Configuration["APS_CALLBACK_URL"];\n        var server_Session_Secret = Configuration["SERVER_SESSION_SECRET"];\n        if (string.IsNullOrEmpty(clientID) || string.IsNullOrEmpty(clientSecret) || string.IsNullOrEmpty(callbackURL) || string.IsNullOrEmpty(server_Session_Secret))\n        {\n            throw new ApplicationException("Missing required environment variables APS_CLIENT_ID, APS_CLIENT_SECRET,APS_CALLBACK_URL or SERVER_SESSION_SECRET");\n        }\n         // highlight-start\n        services.AddSingleton(new APS(clientID, clientSecret, callbackURL));\n        // highlight-end\n    }\n\n    // This method gets called by the runtime. Use this method to configure the HTTP request pipeline.\n    public void Configure(IApplicationBuilder app, IWebHostEnvironment env)\n    {\n        if (env.IsDevelopment())\n        {\n            app.UseDeveloperExceptionPage();\n        }\n        app.UseDefaultFiles();\n        app.UseStaticFiles();\n        app.UseRouting();\n        app.UseEndpoints(endpoints =>\n        {\n            endpoints.MapControllers();\n        });\n    }\n}\n')))}m.isMDXComponent=!0;const y={toc:[]},f="wrapper";function b(e){let{components:n,...t}=e;return(0,o.yg)(f,(0,r.A)({},y,t,{components:n,mdxType:"MDXLayout"}),(0,o.yg)("p",null,"Create an ",(0,o.yg)("inlineCode",{parentName:"p"},"AuthController.cs")," file under the ",(0,o.yg)("inlineCode",{parentName:"p"},"Controllers")," subfolder with the following content:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-csharp",metastring:'title="Controllers/AuthController.cs"',title:'"Controllers/AuthController.cs"'},'using System;\nusing System.Threading.Tasks;\nusing Microsoft.AspNetCore.Http;\nusing Microsoft.AspNetCore.Mvc;\nusing Microsoft.Extensions.Logging;\nusing Newtonsoft.Json.Linq;\n\n[ApiController]\n[Route("api/[controller]")]\npublic class AuthController : ControllerBase\n{\n    private readonly ILogger<AuthController> _logger;\n    private readonly APS _aps;\n\n    public AuthController(ILogger<AuthController> logger, APS aps)\n    {\n        _logger = logger;\n        _aps = aps;\n    }\n\n    public static async Task<Tokens> PrepareTokens(HttpRequest request, HttpResponse response, APS aps)\n    {\n        if (!request.Cookies.ContainsKey("access_token"))\n        {\n            return null;\n        }\n        var tokens = new Tokens\n        {\n            AccessToken = request.Cookies["access_token"],\n            RefreshToken = request.Cookies["refresh_token"],\n            ExpiresAt = DateTime.Parse(request.Cookies["expires_at"])\n        };\n        if (tokens.ExpiresAt < DateTime.Now.ToUniversalTime())\n        {\n            tokens = await aps.RefreshTokens(tokens);\n            response.Cookies.Append("access_token", tokens.AccessToken);\n            response.Cookies.Append("refresh_token", tokens.RefreshToken);\n            response.Cookies.Append("expires_at", tokens.ExpiresAt.ToString());\n        }\n        return tokens;\n    }\n\n    [HttpGet("login")]\n    public ActionResult Login()\n    {\n        var redirectUri = _aps.GetAuthorizationURL();\n        return Redirect(redirectUri);\n    }\n\n    [HttpGet("logout")]\n    public ActionResult Logout()\n    {\n        Response.Cookies.Delete("access_token");\n        Response.Cookies.Delete("refresh_token");\n        Response.Cookies.Delete("expires_at");\n        return Redirect("/");\n    }\n\n    [HttpGet("callback")]\n    public async Task<ActionResult> Callback(string code)\n    {\n        var tokens = await _aps.GenerateTokens(code);\n        Response.Cookies.Append("access_token", tokens.AccessToken);\n        Response.Cookies.Append("refresh_token", tokens.RefreshToken);\n        Response.Cookies.Append("expires_at", tokens.ExpiresAt.ToString());\n        return Redirect("/");\n    }\n\n    [HttpGet("profile")]\n    public async Task<dynamic> GetProfile()\n    {\n\n        var tokens = await PrepareTokens(Request, Response, _aps);\n        if (tokens == null)\n        {\n            return Unauthorized();\n        }\n        dynamic profile = await _aps.GetUserProfile(tokens);\n        return new\n        {\n            name = profile.Name\n        };\n    }\n}\n')),(0,o.yg)("p",null,"The controller handles several different endpoints:"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"GET /api/auth/login")," will redirect the user to the Autodesk login page"),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"GET /api/auth/callback")," is the URL our user will be redirected to after logging in successfully,\nand it is where we're going to generate a new set of tokens for the user"),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"GET /api/auth/logout")," will remove any cookie-based session data for the given user, effectively\nlogging the user out of our application"),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"GET /api/auth/profile")," will return a simple JSON with additional information about the logged in user")))}b.isMDXComponent=!0;const k={toc:[]},v="wrapper";function C(e){let{components:n,...a}=e;return(0,o.yg)(v,(0,r.A)({},k,a,{components:n,mdxType:"MDXLayout"}),(0,o.yg)("p",null,"If the application is still running, restart it (for example, using ",(0,o.yg)("em",{parentName:"p"},"Run > Restart Debugging"),",\nor by clicking the green restart icon), otherwise start it again (using ",(0,o.yg)("em",{parentName:"p"},"Run > Start Debugging"),",\nor by pressing ",(0,o.yg)("inlineCode",{parentName:"p"},"F5"),")."),(0,o.yg)("p",null,"When you navigate to ",(0,o.yg)("a",{parentName:"p",href:"http://localhost:8080/api/auth/login"},"http://localhost:8080/api/auth/login"),"\nin the browser, you should be redirected to Autodesk login page, and after logging in, you should\nbe redirected back to your application, for now simply returning 404. This is expected as we haven't\nimplemented the ",(0,o.yg)("inlineCode",{parentName:"p"},"GET /")," endpoint yet. However, if you use browser dev tools and explore the cookies\nstored by your browser for the ",(0,o.yg)("inlineCode",{parentName:"p"},"localhost")," origin, you'll notice that the application is already\nstoring the authentication data there."),(0,o.yg)("admonition",{type:"info"},(0,o.yg)("p",{parentName:"admonition"},"Here's where you can find your website cookies in different browsers:"),(0,o.yg)("ul",{parentName:"admonition"},(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"https://developer.chrome.com/docs/devtools/storage/sessionstorage/"},"Chrome")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Tools/Storage_Inspector/Cookies"},"Firefox")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"https://docs.microsoft.com/en-us/microsoft-edge/devtools-guide-chromium/storage/cookies"},"Edge")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"https://developer.apple.com/safari/tools/"},"Safari")))),(0,o.yg)("p",null,(0,o.yg)("img",{alt:"Empty Response",src:t(7519).A,width:"1500",height:"929"})))}C.isMDXComponent=!0;const A={toc:[]},w="wrapper";function N(e){let{components:n,...a}=e;return(0,o.yg)(w,(0,r.A)({},A,a,{components:n,mdxType:"MDXLayout"}),(0,o.yg)("p",null,"If the application is still running, restart it (for example, using ",(0,o.yg)("em",{parentName:"p"},"Debug > Restart"),",\nor by pressing ",(0,o.yg)("inlineCode",{parentName:"p"},"Ctrl"),"+",(0,o.yg)("inlineCode",{parentName:"p"},"Shift"),"+",(0,o.yg)("inlineCode",{parentName:"p"},"F5"),"), otherwise start it again (using ",(0,o.yg)("em",{parentName:"p"},"Debug > Start Debugging"),",\nor by pressing ",(0,o.yg)("inlineCode",{parentName:"p"},"F5"),")."),(0,o.yg)("p",null,"When you navigate to ",(0,o.yg)("a",{parentName:"p",href:"http://localhost:8080/api/auth/login"},"http://localhost:8080/api/auth/login"),"\nin the browser, you should be redirected to Autodesk login page, and after logging in, you should\nbe redirected back to your application, for now simply returning 404. This is expected as we haven't\nimplemented the ",(0,o.yg)("inlineCode",{parentName:"p"},"GET /")," endpoint yet. However, if you use browser dev tools and explore the cookies\nstored by your browser for the ",(0,o.yg)("inlineCode",{parentName:"p"},"localhost")," origin, you'll notice that the application is already\nstoring the authentication data there."),(0,o.yg)("admonition",{type:"info"},(0,o.yg)("p",{parentName:"admonition"},"Here's where you can find your website cookies in different browsers:"),(0,o.yg)("ul",{parentName:"admonition"},(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"https://developer.chrome.com/docs/devtools/storage/sessionstorage/"},"Chrome")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Tools/Storage_Inspector/Cookies"},"Firefox")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"https://docs.microsoft.com/en-us/microsoft-edge/devtools-guide-chromium/storage/cookies"},"Edge")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"https://developer.apple.com/safari/tools/"},"Safari")))),(0,o.yg)("p",null,(0,o.yg)("img",{alt:"Empty Response",src:t(7519).A,width:"1500",height:"929"})))}N.isMDXComponent=!0;const T={},S="Authentication",E={unversionedId:"tutorials/acc-admin/auth",id:"tutorials/acc-admin/auth",title:"Authentication",description:"In this step we're going to extend the server implementation so that it can authenticate itself",source:"@site/docs/03-tutorials/05-acc-admin/02-auth.mdx",sourceDirName:"03-tutorials/05-acc-admin",slug:"/tutorials/acc-admin/auth",permalink:"/tutorials/acc-admin/auth",draft:!1,editUrl:"https://github.com/autodesk-platform-services/aps-tutorials-website/edit/master/docs/03-tutorials/05-acc-admin/02-auth.mdx",tags:[],version:"current",sidebarPosition:2,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Application Setup",permalink:"/tutorials/acc-admin/setup"},next:{title:"Project Browsing",permalink:"/tutorials/acc-admin/data"}},_={},x=[{value:"Access tokens",id:"access-tokens",level:2},{value:"Server endpoints",id:"server-endpoints",level:2},{value:"Try it out",id:"try-it-out",level:2}],R={toc:x},D="wrapper";function I(e){let{components:n,...t}=e;return(0,o.yg)(D,(0,r.A)({},R,t,{components:n,mdxType:"MDXLayout"}),(0,o.yg)("h1",{id:"authentication"},"Authentication"),(0,o.yg)("p",null,"In this step we're going to extend the server implementation so that it can authenticate itself\nto the APS platform, guide the user through a ",(0,o.yg)("a",{parentName:"p",href:"https://aps.autodesk.com/en/docs/oauth/v2/tutorials/get-3-legged-token"},"3-legged OAuth workflow"),",\nand generate access tokens for various needs."),(0,o.yg)("h2",{id:"access-tokens"},"Access tokens"),(0,o.yg)(a.A,{NodeJsVsCode:l,DotNetVsCode:m,DotNetVs2022:m,mdxType:"EnvTabs"}),(0,o.yg)("h2",{id:"server-endpoints"},"Server endpoints"),(0,o.yg)("p",null,"Now let's expose this functionality via a collection of endpoints in our server."),(0,o.yg)(a.A,{NodeJsVsCode:p,DotNetVsCode:b,DotNetVs2022:b,mdxType:"EnvTabs"}),(0,o.yg)("h2",{id:"try-it-out"},"Try it out"),(0,o.yg)(a.A,{NodeJsVsCode:d.Ay,DotNetVsCode:C,DotNetVs2022:N,mdxType:"EnvTabs"}))}I.isMDXComponent=!0},2213:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/empty-response-449d92b063a2380003d09b03f156f917.webp"},4472:(e,n,t)=>{t.d(n,{A:()=>i});var r=t(6540),o=t(9489),a=t(7227);function i(e){let{NodeJsVsCode:n,DotNetVsCode:t,DotNetVs2022:i}=e;return r.createElement(o.A,{groupId:"development-environment"},r.createElement(a.A,{value:"nodejs-vscode",label:"Node.js & VSCode",default:!0},r.createElement(n,null)),r.createElement(a.A,{value:"dotnet-vscode",label:".NET & VSCode"},r.createElement(t,null)),r.createElement(a.A,{value:"dotnet-vs2022",label:".NET & VS2022"},r.createElement(i,null)))}},5680:(e,n,t)=>{t.d(n,{xA:()=>u,yg:()=>h});var r=t(6540);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var l=r.createContext({}),c=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},u=function(e){var n=c(e.components);return r.createElement(l.Provider,{value:n},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},g=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=c(t),g=o,h=p["".concat(l,".").concat(g)]||p[g]||d[g]||a;return t?r.createElement(h,i(i({ref:n},u),{},{components:t})):r.createElement(h,i({ref:n},u))}));function h(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var a=t.length,i=new Array(a);i[0]=g;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s[p]="string"==typeof e?e:o,i[1]=s;for(var c=2;c<a;c++)i[c]=t[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}g.displayName="MDXCreateElement"},7227:(e,n,t)=>{t.d(n,{A:()=>i});var r=t(6540),o=t(53);const a={tabItem:"tabItem_Ymn6"};function i(e){let{children:n,hidden:t,className:i}=e;return r.createElement("div",{role:"tabpanel",className:(0,o.A)(a.tabItem,i),hidden:t},n)}},7408:(e,n,t)=>{t.d(n,{Ay:()=>s});var r=t(8168),o=(t(6540),t(5680));const a={toc:[]},i="wrapper";function s(e){let{components:n,...s}=e;return(0,o.yg)(i,(0,r.A)({},a,s,{components:n,mdxType:"MDXLayout"}),(0,o.yg)("p",null,"If the application is still running, restart it (for example, using ",(0,o.yg)("em",{parentName:"p"},"Run > Restart Debugging"),",\nor by clicking the green restart icon), otherwise start it again (using ",(0,o.yg)("em",{parentName:"p"},"Run > Start Debugging"),",\nor by pressing ",(0,o.yg)("inlineCode",{parentName:"p"},"F5"),")."),(0,o.yg)("p",null,"When you navigate to ",(0,o.yg)("a",{parentName:"p",href:"http://localhost:8080/api/auth/login"},"http://localhost:8080/api/auth/login"),"\nin the browser, you should be redirected to Autodesk login page, and after logging in,\nyou should be redirected back to your application, for now simply showing ",(0,o.yg)("inlineCode",{parentName:"p"},"Cannot GET /"),".\nThis is expected as we haven't implemented the ",(0,o.yg)("inlineCode",{parentName:"p"},"GET /")," endpoint yet. However, if you use\nbrowser dev tools and explore the cookies stored by your browser for the ",(0,o.yg)("inlineCode",{parentName:"p"},"localhost")," origin,\nyou'll notice that the application is already storing the authentication data there."),(0,o.yg)("admonition",{type:"info"},(0,o.yg)("p",{parentName:"admonition"},"Here's where you can find your website cookies in different browsers:"),(0,o.yg)("ul",{parentName:"admonition"},(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"https://developer.chrome.com/docs/devtools/storage/sessionstorage/"},"Chrome")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Tools/Storage_Inspector/Cookies"},"Firefox")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"https://docs.microsoft.com/en-us/microsoft-edge/devtools-guide-chromium/storage/cookies"},"Edge")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"https://developer.apple.com/safari/tools/"},"Safari")))),(0,o.yg)("p",null,(0,o.yg)("img",{alt:"Empty Response",src:t(2213).A,width:"1500",height:"929"})))}s.isMDXComponent=!0},7519:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/empty-response-450925c17b800559c0109e7793d17786.webp"},9489:(e,n,t)=>{t.d(n,{A:()=>C});var r=t(8168),o=t(6540),a=t(53),i=t(4245),s=t(6347),l=t(2814),c=t(5167),u=t(1269);function p(e){return function(e){return o.Children.map(e,(e=>{if(!e||(0,o.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:n,label:t,attributes:r,default:o}}=e;return{value:n,label:t,attributes:r,default:o}}))}function d(e){const{values:n,children:t}=e;return(0,o.useMemo)((()=>{const e=n??p(t);return function(e){const n=(0,c.X)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function g(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function h(e){let{queryString:n=!1,groupId:t}=e;const r=(0,s.W6)(),a=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:n,groupId:t});return[(0,l.aZ)(a),(0,o.useCallback)((e=>{if(!a)return;const n=new URLSearchParams(r.location.search);n.set(a,e),r.replace({...r.location,search:n.toString()})}),[a,r])]}function m(e){const{defaultValue:n,queryString:t=!1,groupId:r}=e,a=d(e),[i,s]=(0,o.useState)((()=>function(e){let{defaultValue:n,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!g({value:n,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const r=t.find((e=>e.default))??t[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:n,tabValues:a}))),[l,c]=h({queryString:t,groupId:r}),[p,m]=function(e){let{groupId:n}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(n),[r,a]=(0,u.Dv)(t);return[r,(0,o.useCallback)((e=>{t&&a.set(e)}),[t,a])]}({groupId:r}),y=(()=>{const e=l??p;return g({value:e,tabValues:a})?e:null})();(0,o.useLayoutEffect)((()=>{y&&s(y)}),[y]);return{selectedValue:i,selectValue:(0,o.useCallback)((e=>{if(!g({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);s(e),c(e),m(e)}),[c,m,a]),tabValues:a}}var y=t(1062);const f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function b(e){let{className:n,block:t,selectedValue:s,selectValue:l,tabValues:c}=e;const u=[],{blockElementScrollPositionUntilNextRender:p}=(0,i.a_)(),d=e=>{const n=e.currentTarget,t=u.indexOf(n),r=c[t].value;r!==s&&(p(n),l(r))},g=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const t=u.indexOf(e.currentTarget)+1;n=u[t]??u[0];break}case"ArrowLeft":{const t=u.indexOf(e.currentTarget)-1;n=u[t]??u[u.length-1];break}}n?.focus()};return o.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.A)("tabs",{"tabs--block":t},n)},c.map((e=>{let{value:n,label:t,attributes:i}=e;return o.createElement("li",(0,r.A)({role:"tab",tabIndex:s===n?0:-1,"aria-selected":s===n,key:n,ref:e=>u.push(e),onKeyDown:g,onClick:d},i,{className:(0,a.A)("tabs__item",f.tabItem,i?.className,{"tabs__item--active":s===n})}),t??n)})))}function k(e){let{lazy:n,children:t,selectedValue:r}=e;const a=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=a.find((e=>e.props.value===r));return e?(0,o.cloneElement)(e,{className:"margin-top--md"}):null}return o.createElement("div",{className:"margin-top--md"},a.map(((e,n)=>(0,o.cloneElement)(e,{key:n,hidden:e.props.value!==r}))))}function v(e){const n=m(e);return o.createElement("div",{className:(0,a.A)("tabs-container",f.tabList)},o.createElement(b,(0,r.A)({},e,n)),o.createElement(k,(0,r.A)({},e,n)))}function C(e){const n=(0,y.A)();return o.createElement(v,(0,r.A)({key:String(n)},e))}}}]);