"use strict";(self.webpackChunkaps_tutorials_website=self.webpackChunkaps_tutorials_website||[]).push([[5411],{3128:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/acc-administrator-final-app-a037032ceb35d380fcb0b6d845130dda.webp"},5680:(e,t,n)=>{n.d(t,{xA:()=>p,yg:()=>y});var a=n(6540);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=c(n),m=r,y=d["".concat(s,".").concat(m)]||d[m]||u[m]||o;return n?a.createElement(y,i(i({ref:t},p),{},{components:n})):a.createElement(y,i({ref:t},p))}));function y(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:r,i[1]=l;for(var c=2;c<o;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},5736:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/projects-status-96d9a190e7e1c05d117f71482aa7193e.png"},7918:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/excel-data-type-a7a0b889297d21c3854c5ef6ad52af7c.png"},9560:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var a=n(8168),r=(n(6540),n(5680));const o={},i="Table",l={unversionedId:"tutorials/acc-admin/table",id:"tutorials/acc-admin/table",title:"Table",description:"Finally, we're ready to implement all the remaining logic of the class Table.",source:"@site/docs/03-tutorials/05-acc-admin/06-table.mdx",sourceDirName:"03-tutorials/05-acc-admin",slug:"/tutorials/acc-admin/table",permalink:"/tutorials/acc-admin/table",draft:!1,editUrl:"https://github.com/autodesk-platform-services/aps-tutorials-website/edit/master/docs/03-tutorials/05-acc-admin/06-table.mdx",tags:[],version:"current",sidebarPosition:6,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"UI Framework",permalink:"/tutorials/acc-admin/ui"},next:{title:"ACC Issues (beta)",permalink:"/tutorials/acc-issues/"}},s={},c=[{value:"Table",id:"table-1",level:2},{value:"Load Table Data",id:"load-table-data",level:2},{value:"CSV File Prepare",id:"csv-file-prepare",level:2},{value:"Try it out",id:"try-it-out",level:2}],p={toc:c},d="wrapper";function u(e){let{components:t,...o}=e;return(0,r.yg)(d,(0,a.A)({},p,o,{components:t,mdxType:"MDXLayout"}),(0,r.yg)("h1",{id:"table"},"Table"),(0,r.yg)("p",null,"Finally, we're ready to implement all the remaining logic of the class ",(0,r.yg)("inlineCode",{parentName:"p"},"Table"),".\nThe class ",(0,r.yg)("inlineCode",{parentName:"p"},"Table")," is responsible to handle different type of data, including project list,\nuser list, and provide the functions including:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Get the data list from ACC Admin App based on the current input information."),(0,r.yg)("li",{parentName:"ul"},"Draw the current data list into a bootstrap table."),(0,r.yg)("li",{parentName:"ul"},"Export the current data list into a csv file."),(0,r.yg)("li",{parentName:"ul"},"Import the data from a csv file into the ACC Admin.")),(0,r.yg)("h2",{id:"table-1"},"Table"),(0,r.yg)("p",null,"Let's start by implementing the Table functionality.\nOpen ",(0,r.yg)("inlineCode",{parentName:"p"},"table.js")," file under the ",(0,r.yg)("inlineCode",{parentName:"p"},"wwwroot")," subfolder, add the implementation code into Class ",(0,r.yg)("inlineCode",{parentName:"p"},"Table"),":\nHere are the explanation of the main function:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"resetData"),": Fetch and setup the data based on the input accountId, projectId, and tabKey. "),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"drawTable"),": Draw the bootstrap table with the current data. "),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"exportToCSV"),": Export the current data into CSV file."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"importFromCSV"),": Import the information into ACC Admin system from the prepared CSV file.")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js",metastring:'title="wwwroot/table.js"',title:'"wwwroot/table.js"'},"//////////////////////////////////////////////////////////////////////////////////////////////////////////\n//Table class wraps the specific data info\nclass Table {\n    #tableId;\n    #accountId;\n    #projectId;\n    #tabKey;\n    #dataSet;\n    #maxItem;\n\n    constructor(tableId, accountId = null, projectId = null, tabKey = 'PROJECTS') {\n        this.#tableId = tableId;\n        this.#accountId = accountId;\n        this.#projectId = projectId;\n        this.#tabKey = tabKey;\n        this.#dataSet = null;\n        this.#maxItem = 5;\n    };\n\n    get tabKey(){\n        return this.#tabKey;\n    }\n\n    set tabKey( tabKey){\n        this.#tabKey = tabKey;\n    }\n\n// highlight-start\n    resetData = async( tabKey=null, accountId=null, projectId=null ) =>{\n        this.#tabKey = tabKey? tabKey: this.#tabKey;\n        this.#accountId = accountId? accountId: this.#accountId;\n        this.#projectId = accountId||projectId? projectId: this.#projectId;\n        const url = TABLE_TABS[this.#tabKey].REQUEST_URL;\n        const data = {\n            'accountId': this.#accountId,\n            'projectId': this.#projectId\n        }\n        try {\n            const response = await axios.get(url, { params: data } );\n            this.#dataSet = response.data;\n        } catch (err) {\n            console.error(err);\n            return;\n        }\n        // Mark \"N/A\" for complicated properties.\n        for (var key in this.#dataSet[0]) {\n            if (Array.isArray(this.#dataSet[0][key]) || typeof this.#dataSet[0][key] === 'object' && this.#dataSet[0][key] != null) {\n                this.#dataSet.forEach(item => {\n                    item[key] = \"N/A\";\n                })\n            }\n        }\n    }\n\n    drawTable = () => {\n        if (this.#dataSet == null || this.#dataSet.length == 0) {\n            console.warn('DataSet is not ready, please fetch your data first.');\n            return;\n        }\n\n        let columns = [];\n        for (var key in this.#dataSet[0]) {\n            columns.push({\n                field: key,\n                title: key,\n                align: \"center\"\n            })\n        }\n        $(this.#tableId).bootstrapTable('destroy');\n        $(this.#tableId).bootstrapTable({\n            data: this.#dataSet,\n            customToolbarButtons: [\n                {\n                    name: \"grid-export\",\n                    title: \"Export\",\n                    icon: \"glyphicon-export\",\n                    callback: this.exportToCSV\n                },\n                {\n                    name: \"grid-import\",\n                    title: \"Import\",\n                    icon: \"glyphicon-import\",\n                    callback: this.importFromCSV\n                }\n            ],\n            editable: true,\n            clickToSelect: true,\n            cache: false,\n            showToggle: false,\n            pagination: true,\n            pageList: [5],\n            pageSize: 5,\n            pageNumber: 1,\n            uniqueId: 'id',\n            striped: true,\n            search: true,\n            showRefresh: true,\n            minimumCountColumns: 2,\n            smartDisplay: true,\n            columns: columns\n        });\n    }\n\n    exportToCSV = ()=>{\n        if (this.#dataSet == null || this.#dataSet.length == 0) {\n            console.warn('DataSet is not ready, please fetch your data first.');\n            return;\n        }\n        let csvDataList = [];\n        let csvHeader = [];\n        for (let key in this.#dataSet[0]) {\n            csvHeader.push(key);\n        }\n        csvDataList.push(csvHeader);\n        this.#dataSet.forEach((row) => {\n            let csvRowItem = [];\n            for (let key in row) {\n                if (typeof row[key] === 'string')\n                    csvRowItem.push(\"\\\"\" + row[key].replace(/\\\"/g, \"\\\"\\\"\").replace(\"#\", \"\") + \"\\\"\")\n                else\n                    csvRowItem.push(row[key]);\n            }\n            csvDataList.push(csvRowItem);\n        })\n        let csvString = csvDataList.join(\"%0A\");\n        let a = document.createElement('a');\n        a.href = 'data:attachment/csv,' + csvString;\n        a.target = '_blank';\n        a.download = this.#tabKey + (new Date()).getTime() + '.csv';\n        document.body.appendChild(a);\n        a.click();\n    }\n\n    importFromCSV = async() => {\n        let input = document.createElement('input');\n        input.type = 'file';\n        input.onchange = _ => {\n            let fileUpload = Array.from(input.files);\n            var regex = /^([a-zA-Z0-9\\s_\\\\.\\-:\\(\\)])+(.csv|.txt)$/;\n            if (regex.test(fileUpload[0].name.toLowerCase())) {\n                if (typeof (FileReader) != \"undefined\") {\n                    var reader = new FileReader();\n                    reader.onload = async (e) => {\n                        function sleep(ms = 0) {\n                            return new Promise(resolve => setTimeout(resolve, ms));\n                        }\n                        $(\"#loadingoverlay\").fadeIn()\n                        const rows = e.target.result.split(\"\\r\\n\");\n                        const keys = rows[0].split(',');\n                        let requestDataList = [];\n                        for (let i = 1; i < rows.length && i <= this.#maxItem; i++) {\n                            let jsonItem = {};\n                            let cells = rows[i].split(\",\");\n                            for (let j = 0; j < cells.length; j++) {\n                                if (cells[j] == null || cells[j] == '')\n                                    continue\n                                // customize the input property\n                                let key = keys[j];\n                                switch (this.#tabKey) {\n                                    case 'PROJECTS':\n                                        if (key == 'template') {\n                                            jsonItem[key] = { 'projectId': cells[j] };\n                                            continue;\n                                        }\n                                        break;\n                                    case 'PROJECT':\n                                    case 'USERS':\n                                        if (key == 'roleIds') {\n                                            const roleIdList = cells[j].replace(/\\s/g, '').split('|');\n                                            jsonItem[key] = roleIdList;\n                                            continue;\n                                        }\n                                        const params = key.split('.')\n                                        const length = params.length;\n                                        if (length == 2 && params[0] == 'products') {\n                                            let productAccess = {\n                                                \"key\": params[length - 1],\n                                                \"access\": cells[j]\n                                            }\n                                            if (jsonItem[\"products\"] == null) {\n                                                jsonItem[\"products\"] = [];\n                                            }\n                                            jsonItem[\"products\"].push(productAccess)\n                                            continue\n                                        }\n                                        break;\n                                    default:\n                                        console.warn(\"The current Admin Data Type is not expected\");\n                                        break;\n                                }\n                                jsonItem[key] = cells[j];\n                            }\n                            requestDataList.push(jsonItem);\n                        }\n                        const data = {\n                            'accountId': this.#accountId,\n                            'projectId': this.#projectId,\n                            'data': requestDataList\n                        }\n                        const url = TABLE_TABS[this.#tabKey].REQUEST_URL;\n                        try {\n                            const resp = await axios.post(url, data);\n                            resp.data.succeed && resp.data.succeed.forEach( item => console.log( item + ' is created'));\n                            resp.data.failed && resp.data.failed.forEach( item => console.warn( item + ' failed to be created') );\n                            await sleep(3000);\n                            await this.resetData();\n                        } catch (err) {\n                            console.error(err);\n                        }\n                        this.drawTable();\n                        $(\"#loadingoverlay\").fadeOut()\n                    }\n                    reader.readAsText(fileUpload[0]);\n                } else {\n                    alert(\"This browser does not support HTML5.\");\n                }\n            } else {\n                alert(\"Please upload a valid CSV file.\");\n            }\n        };\n        input.click();\n    }    \n// highlight-end\n}\n")),(0,r.yg)("admonition",{type:"note"},(0,r.yg)("p",{parentName:"admonition"},'Please note that some complicated properties are just marked as "N/A" to simplify the tutorial,\nand during import, the code will parse the propery information from a CSV file into the request\nbody.')),(0,r.yg)("h2",{id:"load-table-data"},"Load Table Data"),(0,r.yg)("p",null,"Now, let's complete the logic to load the data within the following 2 functions:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"initTableTabs"),(0,r.yg)("li",{parentName:"ul"},"refreshTable")),(0,r.yg)("p",null,"Update the code within the above 2 functions by modifying ",(0,r.yg)("inlineCode",{parentName:"p"},"table.js"),":"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js",metastring:'title="wwwroot/table.js"',title:'"wwwroot/table.js"'},'export async function refreshTable( accountId = null, projectId=null ) {\n    $("#loadingoverlay").fadeIn()\n    if( TABLE_TABS[g_accDataTable.tabKey].CATEGORY_NAME==\'hub\' && projectId ){\n        for (let key in TABLE_TABS) {\n            if( TABLE_TABS[key].CATEGORY_NAME == \'hub\' ){\n                $("#" + key).addClass("hidden");\n                $("#" + key).removeClass("active");\n            }\n            else{\n                if( TABLE_TABS[key].CATEGORY_DEFAULT )\n                    $("#" + key).addClass("active");\n                $("#" + key).removeClass("hidden");\n            }\n        } \n    }\n    if (TABLE_TABS[g_accDataTable.tabKey].CATEGORY_NAME == \'project\' && !projectId) {\n        for (let key in TABLE_TABS) {\n            if (TABLE_TABS[key].CATEGORY_NAME == \'hub\') {\n                $("#" + key).removeClass("hidden");\n                if (TABLE_TABS[key].CATEGORY_DEFAULT)\n                    $("#" + key).addClass("active");\n            }\n            else {\n                $("#" + key).addClass("hidden");\n                $("#" + key).removeClass("active");\n            }\n        }\n    }\n    const activeTab = $("ul#adminTableTabs li.active")[0].id;\n// highlight-start\n    try{\n        await g_accDataTable.resetData( activeTab, accountId, projectId );\n        g_accDataTable.drawTable();\n    }catch(err){\n        console.warn(err);\n    }\n// highlight-end\n    $("#loadingoverlay").fadeOut()\n}\n\nexport async function initTableTabs(){\n    // add all tabs\n    for (let key in TABLE_TABS) {\n        $(\'<li id=\' + key + \'><a href="accTable" data-toggle="tab">\' + TABLE_TABS[key].TAB_NAME + \'</a></li>\').appendTo(\'#adminTableTabs\');\n        $("#" + key).addClass((TABLE_TABS[key].CATEGORY_NAME == \'hub\' && TABLE_TABS[key].CATEGORY_DEFAULT) ? "active" : "hidden");\n    } \n    // event on the tabs\n    $(\'a[data-toggle="tab"]\').on(\'shown.bs.tab\', async function (e) {\n        $("#loadingoverlay").fadeIn()\n        const activeTab = e.target.parentElement.id;\n// highlight-start\n        try {\n            await g_accDataTable.resetData(activeTab);\n            g_accDataTable.drawTable();\n        } catch (err) {\n            console.warn(err);\n        }    \n// highlight-end\n        $("#loadingoverlay").fadeOut()\n    });  \n}\n')),(0,r.yg)("h2",{id:"csv-file-prepare"},"CSV File Prepare"),(0,r.yg)("p",null,"Finally, the most important feature is batch import projects/users, this is achieved by using a CSV file,\nwe provided 2 template files for projects and users, you can add/modify your information based on the template,\nthen import these data from CSV file into ACC account."),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"https://github.com/autodesk-platform-services/aps-acc-admin-tutorial-nodejs/blob/main/template%20files/ProjectsTemplate.csv"},"ProjectsTemplate.csv")," "),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"https://github.com/autodesk-platform-services/aps-acc-admin-tutorial-nodejs/blob/main/template%20files/UsersTemplate.csv"},"UsersTemplate.csv")," ")),(0,r.yg)("admonition",{type:"caution"},(0,r.yg)("ul",{parentName:"admonition"},(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"When import projects to the hub, make sure the ",(0,r.yg)("strong",{parentName:"p"},"Project Name")," prepared in the CSV file\nis not existing in the hub, otherwise, the project can not created due to the name conflicts.")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"When import users to the project, the column ",(0,r.yg)("strong",{parentName:"p"},(0,r.yg)("inlineCode",{parentName:"strong"},"roleIds"))," of CSV file supports multiple roles for the project user,\nplease use ",(0,r.yg)("strong",{parentName:"p"},'"|"')," as separator.")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"If you open the CSV file with Microsoft Excel, some data type will be automatically changed by the setting, for example, the column of\n",(0,r.yg)("strong",{parentName:"p"},"startDate")," might be changed to the type as ",(0,r.yg)("strong",{parentName:"p"},'"2012/03/14"'),", please make sure to select another type like ",(0,r.yg)("strong",{parentName:"p"},'"2012-03-14"')," without ",(0,r.yg)("strong",{parentName:"p"},'"/"')," as shown in the screenshot,\notherwise the date will not be recognized correctly after exporting to CSV file.")))),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"Excel Data Format",src:n(7918).A,width:"1507",height:"755"})),(0,r.yg)("admonition",{type:"tip"},(0,r.yg)("ul",{parentName:"admonition"},(0,r.yg)("li",{parentName:"ul"},"When importing projects, you can always open the ",(0,r.yg)("strong",{parentName:"li"},"Developer Tools")," and check the console\nfor the status of these projects as picture shown below, be noted this only work for importing\nprojects, not work for importing users."))),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"Projects Status",src:n(5736).A,width:"1919",height:"779"})),(0,r.yg)("h2",{id:"try-it-out"},"Try it out"),(0,r.yg)("p",null,"And that's it! Your application is now ready for action. Start it as usual, and when you go to\n",(0,r.yg)("a",{parentName:"p",href:"http://localhost:8080"},"http://localhost:8080"),", you should be presented with a simple UI, with\na tree-view on the left side, you can do the following operation:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Select an ACC Hub: The table will list all the ACC Projects, you can export all the projects to a CSV file by click\nthe ",(0,r.yg)("inlineCode",{parentName:"li"},"Export")," button, or import the prepared projects by a CSV file with Projects information."),(0,r.yg)("li",{parentName:"ul"},"Select an ACC Project: There are 2 tabs, ",(0,r.yg)("inlineCode",{parentName:"li"},"PROJECT")," and ",(0,r.yg)("inlineCode",{parentName:"li"},"USERS"),", ",(0,r.yg)("inlineCode",{parentName:"li"},"PROJECT")," tab will list the detail information about this\nproject, only export is available, ",(0,r.yg)("inlineCode",{parentName:"li"},"USERS")," tab will list all the project users, you can click the ",(0,r.yg)("inlineCode",{parentName:"li"},"Export")," button to export all\nthe project users to a csv file, or click ",(0,r.yg)("inlineCode",{parentName:"li"},"Import")," button to import users into the selected project with a prepare CSV file of User information.")),(0,r.yg)("admonition",{type:"caution"},(0,r.yg)("p",{parentName:"admonition"},"Please note that you can only import the certain type of data based on the active Tab, here\nare the details:"),(0,r.yg)("ul",{parentName:"admonition"},(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"PROJECTS")," Tab: You can only import project list into the selected account, the csv file needs to follow\nthe Projects template, the csv file of Users template can not be imported. You can check the console to see\nif any projects failed."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"PROJECT")," Tab: Nothing can be imported when this tab is active."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"USERS")," Tab: You can only import user list into the selected project, the csv file needs to follow the Users\ntemplate, Projects template can not be imported. Due to the limitation of Import Project Users API, No information to\ntell if any users are failed to be imported."))),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"Final App",src:n(3128).A,width:"1926",height:"1054"})))}u.isMDXComponent=!0}}]);