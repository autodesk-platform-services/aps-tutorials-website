"use strict";(self.webpackChunkaps_tutorials_website=self.webpackChunkaps_tutorials_website||[]).push([[238],{4137:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>h});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),p=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,s=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),d=p(n),h=a,m=d["".concat(l,".").concat(h)]||d[h]||u[h]||s;return n?r.createElement(m,o(o({ref:t},c),{},{components:n})):r.createElement(m,o({ref:t},c))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var s=n.length,o=new Array(s);o[0]=d;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:a,o[1]=i;for(var p=2;p<s;p++)o[p]=n[p];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},6210:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>c,default:()=>g,frontMatter:()=>p,metadata:()=>u,toc:()=>h});var r=n(7462),a=(n(7294),n(4137));const s={toc:[]};function o(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Let's implement the logic for browsing through the individual hubs, projects."),(0,a.kt)("p",null,"First, let's include the Data Management SDK, add the ",(0,a.kt)("inlineCode",{parentName:"p"},"@aps_sdk/data-management")," library, and also create an instance of\nSDK client of ",(0,a.kt)("inlineCode",{parentName:"p"},"DataManagementClient")," at the beginning of ",(0,a.kt)("inlineCode",{parentName:"p"},"services/aps.js")," file:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="services/aps.js"',title:'"services/aps.js"'},"const { SdkManagerBuilder } = require('@aps_sdk/autodesk-sdkmanager');\nconst { AuthenticationClient, Scopes, ResponseType } = require('@aps_sdk/authentication');\n// highlight-start\nconst { DataManagementClient } = require('@aps_sdk/data-management');\n// highlight-end\nconst { APS_CLIENT_ID, APS_CLIENT_SECRET, APS_CALLBACK_URL } = require('../config.js');\n\nconst service = module.exports = {};\n\nconst sdk = SdkManagerBuilder.create().build();\nconst authenticationClient = new AuthenticationClient(sdk);\n// highlight-start\nconst dataManagementClient = new DataManagementClient(sdk);\n// highlight-end\n")),(0,a.kt)("p",null," And then append the following code to the end of the ",(0,a.kt)("inlineCode",{parentName:"p"},"services/aps.js")," file:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="services/aps.js"',title:'"services/aps.js"'},"// Data Management APIs\nservice.getHubs = async (token) => {\n    const resp = await dataManagementClient.getHubs(token.access_token);\n    return resp.data.filter((item)=>{\n        return item.id.startsWith('b.');\n    })\n};\n\nservice.getProjects = async (hubId, token) => {\n    const resp = await dataManagementClient.getHubProjects(token.access_token, hubId);\n    return resp.data.filter( (item)=>{\n        return item.attributes.extension.data.projectType == 'ACC';\n    } )\n};\n")),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"The method dataManagementClient.getHubProjects() will return the projects which\nthe current user is involed, it's different from the ACC Admin GET Projects API which\nreturns all the projects including those the user is not involved.")))}o.isMDXComponent=!0;const i={toc:[]};function l(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},i,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Create a ",(0,a.kt)("inlineCode",{parentName:"p"},"hubs.js")," file under the ",(0,a.kt)("inlineCode",{parentName:"p"},"routes")," subfolder with the following content:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="routes/hubs.js"',title:'"routes/hubs.js"'},"const express = require('express');\nconst { authRefreshMiddleware, getHubs, getProjects } = require('../services/aps.js');\n\nlet router = express.Router();\n\nrouter.use('/api/hubs', authRefreshMiddleware);\n\nrouter.get('/api/hubs', async function (req, res, next) {\n    try {\n        const hubs = await getHubs(req.oAuthToken);\n        res.json(hubs);\n    } catch (err) {\n        next(err);\n    }\n});\n\nrouter.get('/api/hubs/:hub_id/projects', async function (req, res, next) {\n    try {\n        const projects = await getProjects(req.params.hub_id, req.oAuthToken);\n        res.json(projects);\n    } catch (err) {\n        next(err);\n    }\n});\n\nmodule.exports = router;\n")),(0,a.kt)("p",null,"And mount the router to our server application by modifying ",(0,a.kt)("inlineCode",{parentName:"p"},"server.js"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="server.js"',title:'"server.js"'},"const express = require('express');\nconst session = require('cookie-session');\nconst { PORT, SERVER_SESSION_SECRET } = require('./config.js');\n\nlet app = express();\napp.use(express.static('wwwroot'));\napp.use(session({ secret: SERVER_SESSION_SECRET, maxAge: 24 * 60 * 60 * 1000 }));\napp.use(require('./routes/auth.js'));\n// highlight-start\napp.use(require('./routes/hubs.js'));\n// highlight-end\napp.listen(PORT, () => console.log(`Server listening on port ${PORT}...`));\n")))}l.isMDXComponent=!0;const p={},c="Project Browsing",u={unversionedId:"tutorials/acc-admin/data",id:"tutorials/acc-admin/data",title:"Project Browsing",description:"In this step we'll extend our server so that we can browse the projects of Autodesk Construction Cloud.",source:"@site/docs/03-tutorials/05-acc-admin/03-data.mdx",sourceDirName:"03-tutorials/05-acc-admin",slug:"/tutorials/acc-admin/data",permalink:"/tutorials/acc-admin/data",draft:!1,editUrl:"https://github.com/autodesk-platform-services/aps-tutorials-website/edit/master/docs/03-tutorials/05-acc-admin/03-data.mdx",tags:[],version:"current",sidebarPosition:3,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Authentication",permalink:"/tutorials/acc-admin/auth"},next:{title:"Account Admin",permalink:"/tutorials/acc-admin/admin"}},d={},h=[{value:"Browsing hubs",id:"browsing-hubs",level:2},{value:"Server endpoints",id:"server-endpoints",level:2},{value:"Try it out",id:"try-it-out",level:2}],m={toc:h};function g(e){let{components:t,...s}=e;return(0,a.kt)("wrapper",(0,r.Z)({},m,s,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"project-browsing"},"Project Browsing"),(0,a.kt)("p",null,"In this step we'll extend our server so that we can browse the projects of Autodesk Construction Cloud.\nWe will basically get the hierarchy of hubs, projects using Data Management APIs:"),(0,a.kt)("h2",{id:"browsing-hubs"},"Browsing hubs"),(0,a.kt)("p",null,"First, let's add a couple of helper methods for browsing through the hubs, projects:"),(0,a.kt)(o,{mdxType:"NodeJsVsCodeHubs"}),(0,a.kt)("h2",{id:"server-endpoints"},"Server endpoints"),(0,a.kt)("p",null,"Next, let's expose the new functionality to the client-side code through another\nset of endpoints."),(0,a.kt)(l,{mdxType:"NodeJsVsCodeEndpoints"}),(0,a.kt)("h2",{id:"try-it-out"},"Try it out"),(0,a.kt)("p",null,"Start (or restart) the app from Visual Studio Code as usual, and navigate to\n",(0,a.kt)("a",{parentName:"p",href:"http://localhost:8080/api/hubs"},"http://localhost:8080/api/hubs")," in the browser.\nThe server should respond with a JSON list of all the hubs you have access to.\nTry copying the ID of one of the hubs, and use it in another address: http://localhost:8080/api/hubs/your-hub-id/projects.\nIn this case the server application should respond with a JSON list of all projects\navailable under the specified hub."),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"If you skipped the login procedure in the previous step, or restarted your server application,\nyou may need to go to ",(0,a.kt)("a",{parentName:"p",href:"http://localhost:8080/api/auth/login"},"http://localhost:8080/api/auth/login"),"\nagain to make sure that all the authentication data is available in cookies before testing\nthe ",(0,a.kt)("inlineCode",{parentName:"p"},"/api/hubs")," endpoint.")),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"If you are using Google Chrome, consider installing ",(0,a.kt)("a",{parentName:"p",href:"https://chrome.google.com/webstore/detail/json-formatter/bcjindcccaagfpapjjmafapmmgkkhgoa?hl=en"},"JSON Formatter"),"\nor a similar extension to automatically format JSON responses.")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Hubs Response",src:n(8953).Z,width:"1500",height:"929"})))}g.isMDXComponent=!0},8953:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/hubs-response-6ca89cc77b1e67f6197c74b8561d0115.webp"}}]);