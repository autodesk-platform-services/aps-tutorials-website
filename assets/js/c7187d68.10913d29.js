"use strict";(self.webpackChunkaps_tutorials_website=self.webpackChunkaps_tutorials_website||[]).push([[6313],{942:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/projects-response-23642bde254aac9d3d8e6248c9f4b3e4.webp"},1832:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>j,contentTitle:()=>v,default:()=>A,frontMatter:()=>f,metadata:()=>w,toc:()=>C});var a=n(8168),r=(n(6540),n(5680)),s=n(4472);const o={toc:[]},i="wrapper";function l(e){let{components:t,...n}=e;return(0,r.yg)(i,(0,a.A)({},o,n,{components:t,mdxType:"MDXLayout"}),(0,r.yg)("p",null,"Let's implement the logic for browsing through the individual hubs, projects."),(0,r.yg)("p",null,"First, let's include the Data Management SDK, add the ",(0,r.yg)("inlineCode",{parentName:"p"},"@aps_sdk/data-management")," library, and also create an instance of\nSDK client of ",(0,r.yg)("inlineCode",{parentName:"p"},"DataManagementClient")," at the beginning of ",(0,r.yg)("inlineCode",{parentName:"p"},"services/aps.js")," file:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js",metastring:'title="services/aps.js"',title:'"services/aps.js"'},"const { SdkManagerBuilder } = require('@aps_sdk/autodesk-sdkmanager');\nconst { AuthenticationClient, Scopes, ResponseType } = require('@aps_sdk/authentication');\n// highlight-start\nconst { DataManagementClient } = require('@aps_sdk/data-management');\n// highlight-end\nconst { APS_CLIENT_ID, APS_CLIENT_SECRET, APS_CALLBACK_URL, INTERNAL_TOKEN_SCOPES, PUBLIC_TOKEN_SCOPES } = require('../config.js');\n\nconst service = module.exports = {};\n\nconst sdk = SdkManagerBuilder.create().build();\nconst authenticationClient = new AuthenticationClient(sdk);\n// highlight-start\nconst dataManagementClient = new DataManagementClient(sdk);\n// highlight-end\n")),(0,r.yg)("p",null," Next, append the following code to the end of the ",(0,r.yg)("inlineCode",{parentName:"p"},"services/aps.js")," file:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js",metastring:'title="services/aps.js"',title:'"services/aps.js"'},"// Data Management APIs\nservice.getHubs = async (accessToken) => {\n    const resp = await dataManagementClient.getHubs({ accessToken });\n    return resp.data;\n};\n\nservice.getProjects = async (hubId, accessToken) => {\n    const resp = await dataManagementClient.getHubProjects(hubId, { accessToken });\n    return resp.data;\n};  \n")),(0,r.yg)("admonition",{type:"tip"},(0,r.yg)("p",{parentName:"admonition"},"The method dataManagementClient.getHubProjects() only returns these projects that\nthe current logged user is member of.")))}l.isMDXComponent=!0;const u={toc:[]},c="wrapper";function p(e){let{components:t,...n}=e;return(0,r.yg)(c,(0,a.A)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.yg)("p",null,"Create a ",(0,r.yg)("inlineCode",{parentName:"p"},"hubs.js")," file under the ",(0,r.yg)("inlineCode",{parentName:"p"},"routes")," subfolder with the following content:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js",metastring:'title="routes/hubs.js"',title:'"routes/hubs.js"'},"const express = require('express');\nconst { authRefreshMiddleware, getHubs, getProjects } = require('../services/aps.js');\n\nlet router = express.Router();\n\nrouter.use('/api/hubs', authRefreshMiddleware);\n\n\nrouter.get('/api/hubs', async function (req, res, next) {\n    try {\n        const hubs = await getHubs(req.internalOAuthToken.access_token);\n        //build the json response with some data of the hub\n        res.json(hubs.map(hub => ({type:hub.type, id: hub.id, name: hub.attributes.name,region:hub.attributes.region})));\n    } catch (err) {\n        next(err);\n    }\n});\n\nrouter.get('/api/hubs/:hub_id/projects', async function (req, res, next) {\n    try {\n        const projects = await getProjects(req.params.hub_id, req.internalOAuthToken.access_token);\n        //build the json response with some data of the project \n        res.json(projects.map(project => ({type:project.type, id: project.id, name: project.attributes.name, })));\n    } catch (err) {\n        next(err);\n    }\n});\n\nmodule.exports = router;\n\n")),(0,r.yg)("p",null,"And mount the router to our server application by modifying ",(0,r.yg)("inlineCode",{parentName:"p"},"server.js"),":"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js",metastring:'title="server.js"',title:'"server.js"'},"const express = require('express');\nconst session = require('cookie-session');\nconst { PORT, SERVER_SESSION_SECRET } = require('./config.js');\n\nlet app = express();\napp.use(express.static('wwwroot'));\napp.use(session({ secret: SERVER_SESSION_SECRET, maxAge: 24 * 60 * 60 * 1000 }));\napp.use(require('./routes/auth.js'));\n// highlight-start\napp.use(require('./routes/hubs.js'));\n// highlight-end\napp.listen(PORT, () => console.log(`Server listening on port ${PORT}...`));\n")))}p.isMDXComponent=!0;const d={toc:[]},h="wrapper";function g(e){let{components:t,...n}=e;return(0,r.yg)(h,(0,a.A)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.yg)("p",null,"Create a ",(0,r.yg)("inlineCode",{parentName:"p"},"APS.Hubs.cs")," under the ",(0,r.yg)("inlineCode",{parentName:"p"},"Models")," subfolder with the following content:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-csharp",metastring:'title="Models/APS.Hubs.cs"',title:'"Models/APS.Hubs.cs"'},"using System.Collections.Generic;\nusing System.Threading.Tasks;\nusing Autodesk.DataManagement;\nusing Autodesk.DataManagement.Model;\n\npublic partial class APS\n{\n    public async Task<IEnumerable<HubData>> GetHubs(Tokens tokens)\n    {\n        var dataManagementClient = new DataManagementClient();\n        var hubs = await dataManagementClient.GetHubsAsync(accessToken: tokens.InternalToken);\n        return hubs.Data;\n    }\n\n    public async Task<IEnumerable<ProjectData>> GetProjects(string hubId, Tokens tokens)\n    {\n        var dataManagementClient = new DataManagementClient();\n        var projects = await dataManagementClient.GetHubProjectsAsync(hubId, accessToken: tokens.InternalToken);\n        return projects.Data;\n    }\n}\n")))}g.isMDXComponent=!0;const m={toc:[]},b="wrapper";function y(e){let{components:t,...n}=e;return(0,r.yg)(b,(0,a.A)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,r.yg)("p",null,"Create a ",(0,r.yg)("inlineCode",{parentName:"p"},"HubsController.cs")," file under the ",(0,r.yg)("inlineCode",{parentName:"p"},"Controllers")," subfolder with the following content:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-csharp",metastring:'title="Controllers/HubsController.cs"',title:'"Controllers/HubsController.cs"'},'using System.Linq;\nusing System.Threading.Tasks;\nusing Autodesk.DataManagement.Model;\nusing Microsoft.AspNetCore.Mvc;\n\n[ApiController]\n[Route("api/[controller]")]\npublic class HubsController : ControllerBase\n{\n    private readonly APS _aps;\n\n    public HubsController(APS aps)\n    {\n        _aps = aps;\n    }\n\n    [HttpGet()]\n    public async Task<ActionResult> ListHubs()\n    {\n        var tokens = await AuthController.PrepareTokens(Request, Response, _aps);\n        if (tokens == null)\n        {\n            return Unauthorized();\n        }\n        return Ok(\n            from hub in await _aps.GetHubs(tokens)\n            select new { id = hub.Id, name = hub.Attributes.Name }\n        );\n    }\n\n    [HttpGet("{hub}/projects")]\n    public async Task<ActionResult> ListProjects(string hub)\n    {\n        var tokens = await AuthController.PrepareTokens(Request, Response, _aps);\n        if (tokens == null)\n        {\n            return Unauthorized();\n        }\n        return Ok(\n            from project in await _aps.GetProjects(hub, tokens)\n            select new { id = project.Id, name = project.Attributes.Name }\n        );\n    }\n}\n')),(0,r.yg)("p",null,"The controller handles several endpoints for browsing the content in other APS-based\napplications such as BIM 360 Docs and ACC. We will make use of these endpoints when\nbuilding the UI part of the application."))}y.isMDXComponent=!0;const f={},v="Project Browsing",w={unversionedId:"tutorials/acc-issues/data",id:"tutorials/acc-issues/data",title:"Project Browsing",description:"The base URI schema of ACC Issue API is//developer.api.autodesk.com/construction/issues/v1/projects/:projectId",source:"@site/docs/03-tutorials/06-acc-issues/03-data.mdx",sourceDirName:"03-tutorials/06-acc-issues",slug:"/tutorials/acc-issues/data",permalink:"/tutorials/acc-issues/data",draft:!1,editUrl:"https://github.com/autodesk-platform-services/aps-tutorials-website/edit/master/docs/03-tutorials/06-acc-issues/03-data.mdx",tags:[],version:"current",sidebarPosition:3,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Authentication",permalink:"/tutorials/acc-issues/auth"},next:{title:"Project Issues",permalink:"/tutorials/acc-issues/issues"}},j={},C=[{value:"Browsing hubs",id:"browsing-hubs",level:2},{value:"Server endpoints",id:"server-endpoints",level:2},{value:"Try it out",id:"try-it-out",level:2}],k={toc:C},N="wrapper";function A(e){let{components:t,...o}=e;return(0,r.yg)(N,(0,a.A)({},k,o,{components:t,mdxType:"MDXLayout"}),(0,r.yg)("h1",{id:"project-browsing"},"Project Browsing"),(0,r.yg)("p",null,"The base URI schema of ACC Issue API is: ",(0,r.yg)("inlineCode",{parentName:"p"},"https://developer.api.autodesk.com/construction/issues/v1/projects/:projectId"),"\n, where the ",(0,r.yg)("strong",{parentName:"p"},"projectId")," is a required URI parameter. In this step we'll extend the server to browse the projects of Autodesk Construction Cloud, in order to fetch ",(0,r.yg)("strong",{parentName:"p"},"project Id"),".\nWe will basically get the hierarchy of hubs and projects using Data Management APIs."),(0,r.yg)("h2",{id:"browsing-hubs"},"Browsing hubs"),(0,r.yg)("p",null,"We will add a couple of helper methods for browsing through the hubs, projects:"),(0,r.yg)(s.A,{NodeJsVsCode:l,DotNetVsCode:g,DotNetVs2022:g,mdxType:"EnvTabs"}),(0,r.yg)("h2",{id:"server-endpoints"},"Server endpoints"),(0,r.yg)("p",null,"Next, let's expose the new functionality to the client-side code through another\nset of endpoints.\nData Management API returns plentiful data of the object. Our endpoints will extract partial data for client-side."),(0,r.yg)(s.A,{NodeJsVsCode:p,DotNetVsCode:y,DotNetVs2022:y,mdxType:"EnvTabs"}),(0,r.yg)("h2",{id:"try-it-out"},"Try it out"),(0,r.yg)("p",null,"Start (or restart) the app from Visual Studio Code as usual, and navigate to\n",(0,r.yg)("a",{parentName:"p",href:"http://localhost:8080/api/hubs"},"http://localhost:8080/api/hubs")," in the browser.\nThe server should respond with a JSON list of all the hubs you have access to."),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"Hubs Response",src:n(7780).A,width:"2712",height:"694"})),(0,r.yg)("p",null,"Try to copy one hub Id, and use it in another address: ",(0,r.yg)("a",{parentName:"p",href:"http://localhost:8080/api/hubs/your-hub-id/projects"},"http://localhost:8080/api/hubs/your-hub-id/projects"),".\nThe server should respond with a JSON list of all projects available under the specified hub."),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"Projects Response",src:n(942).A,width:"2972",height:"1280"})),(0,r.yg)("admonition",{type:"info"},(0,r.yg)("p",{parentName:"admonition"},"If you have skipped the login procedure in the previous step, or restarted your server application,\nyou may need to go to ",(0,r.yg)("a",{parentName:"p",href:"http://localhost:8080/api/auth/login"},"http://localhost:8080/api/auth/login"),"\nagain to make sure that all the authentication data is available in cookies before testing\nthe ",(0,r.yg)("inlineCode",{parentName:"p"},"/api/hubs")," endpoint.")),(0,r.yg)("admonition",{type:"tip"},(0,r.yg)("p",{parentName:"admonition"},"If you are using Google Chrome, consider installing ",(0,r.yg)("a",{parentName:"p",href:"https://chrome.google.com/webstore/detail/json-formatter/bcjindcccaagfpapjjmafapmmgkkhgoa?hl=en"},"JSON Formatter"),"\nor a similar extension to automatically format JSON responses.")))}A.isMDXComponent=!0},4472:(e,t,n)=>{n.d(t,{A:()=>o});var a=n(6540),r=n(9489),s=n(7227);function o(e){let{NodeJsVsCode:t,DotNetVsCode:n,DotNetVs2022:o}=e;return a.createElement(r.A,{groupId:"development-environment"},a.createElement(s.A,{value:"nodejs-vscode",label:"Node.js & VSCode",default:!0},a.createElement(t,null)),a.createElement(s.A,{value:"dotnet-vscode",label:".NET & VSCode"},a.createElement(n,null)),a.createElement(s.A,{value:"dotnet-vs2022",label:".NET & VS2022"},a.createElement(o,null)))}},5680:(e,t,n)=>{n.d(t,{xA:()=>c,yg:()=>g});var a=n(6540);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),u=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=u(e.components);return a.createElement(l.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,s=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),p=u(n),h=r,g=p["".concat(l,".").concat(h)]||p[h]||d[h]||s;return n?a.createElement(g,o(o({ref:t},c),{},{components:n})):a.createElement(g,o({ref:t},c))}));function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=n.length,o=new Array(s);o[0]=h;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[p]="string"==typeof e?e:r,o[1]=i;for(var u=2;u<s;u++)o[u]=n[u];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},7227:(e,t,n)=>{n.d(t,{A:()=>o});var a=n(6540),r=n(53);const s={tabItem:"tabItem_Ymn6"};function o(e){let{children:t,hidden:n,className:o}=e;return a.createElement("div",{role:"tabpanel",className:(0,r.A)(s.tabItem,o),hidden:n},t)}},7780:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/hubs-response-e8fc2491db6949afbcce4448158a419f.webp"},9489:(e,t,n)=>{n.d(t,{A:()=>j});var a=n(8168),r=n(6540),s=n(53),o=n(4245),i=n(6347),l=n(2814),u=n(5167),c=n(1269);function p(e){return function(e){return r.Children.map(e,(e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:t,label:n,attributes:a,default:r}}=e;return{value:t,label:n,attributes:a,default:r}}))}function d(e){const{values:t,children:n}=e;return(0,r.useMemo)((()=>{const e=t??p(n);return function(e){const t=(0,u.X)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function h(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function g(e){let{queryString:t=!1,groupId:n}=e;const a=(0,i.W6)(),s=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,l.aZ)(s),(0,r.useCallback)((e=>{if(!s)return;const t=new URLSearchParams(a.location.search);t.set(s,e),a.replace({...a.location,search:t.toString()})}),[s,a])]}function m(e){const{defaultValue:t,queryString:n=!1,groupId:a}=e,s=d(e),[o,i]=(0,r.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!h({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const a=n.find((e=>e.default))??n[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:t,tabValues:s}))),[l,u]=g({queryString:n,groupId:a}),[p,m]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[a,s]=(0,c.Dv)(n);return[a,(0,r.useCallback)((e=>{n&&s.set(e)}),[n,s])]}({groupId:a}),b=(()=>{const e=l??p;return h({value:e,tabValues:s})?e:null})();(0,r.useLayoutEffect)((()=>{b&&i(b)}),[b]);return{selectedValue:o,selectValue:(0,r.useCallback)((e=>{if(!h({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);i(e),u(e),m(e)}),[u,m,s]),tabValues:s}}var b=n(1062);const y={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function f(e){let{className:t,block:n,selectedValue:i,selectValue:l,tabValues:u}=e;const c=[],{blockElementScrollPositionUntilNextRender:p}=(0,o.a_)(),d=e=>{const t=e.currentTarget,n=c.indexOf(t),a=u[n].value;a!==i&&(p(t),l(a))},h=e=>{let t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const n=c.indexOf(e.currentTarget)+1;t=c[n]??c[0];break}case"ArrowLeft":{const n=c.indexOf(e.currentTarget)-1;t=c[n]??c[c.length-1];break}}t?.focus()};return r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":n},t)},u.map((e=>{let{value:t,label:n,attributes:o}=e;return r.createElement("li",(0,a.A)({role:"tab",tabIndex:i===t?0:-1,"aria-selected":i===t,key:t,ref:e=>c.push(e),onKeyDown:h,onClick:d},o,{className:(0,s.A)("tabs__item",y.tabItem,o?.className,{"tabs__item--active":i===t})}),n??t)})))}function v(e){let{lazy:t,children:n,selectedValue:a}=e;const s=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=s.find((e=>e.props.value===a));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return r.createElement("div",{className:"margin-top--md"},s.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==a}))))}function w(e){const t=m(e);return r.createElement("div",{className:(0,s.A)("tabs-container",y.tabList)},r.createElement(f,(0,a.A)({},e,t)),r.createElement(v,(0,a.A)({},e,t)))}function j(e){const t=(0,b.A)();return r.createElement(w,(0,a.A)({key:String(t)},e))}}}]);