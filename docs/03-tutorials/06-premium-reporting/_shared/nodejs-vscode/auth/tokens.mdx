Create an `aps.js` file under the `services` folder. This is where we will be implementing
all the APS logic that will be used in different areas of our server application. Let's start
by adding the following code to the file:

```js title="services/aps.js"
const { SdkManagerBuilder } = require("@aps_sdk/autodesk-sdkmanager");
const { AuthenticationClient, Scopes } = require("@aps_sdk/authentication");

const { APS_CLIENT_ID, APS_CLIENT_SECRET } = require("../config.js");

const sdk = SdkManagerBuilder.create().build();
const authenticationClient = new AuthenticationClient(sdk);

const service = (module.exports = {});

service.getInternalToken = async () => {
  const credentials = await authenticationClient.getTwoLeggedToken(
    APS_CLIENT_ID,
    APS_CLIENT_SECRET,
    [
      Scopes.DataRead,
      Scopes.DataCreate,
      Scopes.DataWrite,
      Scopes.BucketCreate,
      Scopes.BucketRead,
    ]
  );
  return credentials;
};

service.getPublicToken = async () => {
  const credentials = await authenticationClient.getTwoLeggedToken(
    APS_CLIENT_ID,
    APS_CLIENT_SECRET,
    [Scopes.DataRead]
  );
  return credentials;
};
```

The code provides a couple of helper functions:

The getAuthorizationUrl function generates a URL for our users to be redirected to when initiating the 3-legged authentication workflow

The authCallbackMiddleware function can be used as an Express.js middleware when the user logs in successfully and is redirected back to our application

The authRefreshMiddleware function is then used as an Express.js middleware for all requests that will need to make use of the APS access tokens

The getUserProfile function returns additional details about the authenticated user based on an existing access token
